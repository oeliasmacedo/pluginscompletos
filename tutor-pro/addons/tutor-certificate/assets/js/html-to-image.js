(()=>{"use strict";var e={};var t=function e(t,n){var a=wp.i18n.__;var r=t||{},o=r.data,i=o===void 0?{}:o;var c=i.message,d=c===void 0?n||a("Something Went Wrong!","tutor-pro"):c;return d};jQuery(document).ready((function(e){var n=window.navigator.userAgent.match(/Firefox\/([0-9]+)\./);var a=n?parseInt(n[1]):0;var r=/^((?!chrome|android).)*safari/i.test(navigator.userAgent);var o=/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor);var i=wp.i18n,c=i.__,d=i._x,s=i._n,u=i._nx;e("body").append('<svg id="tutor_svg_font_id" width="0" height="0" style="background-color:white;"></svg>');var l=function t(n,a){var r=new XMLHttpRequest;r.open("get","?tutor_action=get_fonts&course_id="+n);r.responseType="text";r.send();r.onloadend=function(){var t=r.response;var n=t.match(/https?:\/\/[^ \)]+/g);var o=0;n.forEach((function(r){var i=new XMLHttpRequest;i.open("get",r);i.responseType="blob";i.onloadend=function(){var c=new FileReader;c.onloadend=function(){t=t.replace(new RegExp(r),c.result);o++;if(o==n.length){e("#tutor_svg_font_id").prepend("<style>".concat(t,"</style>"));a()}};c.readAsDataURL(i.response)};i.send()}))}};var f=function e(t){var n=document.createElement("canvas");var a=n.getContext("2d");n.width=t.naturalWidth;n.height=t.naturalHeight;a.drawImage(t,0,0);return n.toDataURL("image/png")};var p=function e(t,n){var a=t.getElementsByTagName("img");var r=0;function o(){if(r>=a.length){n();return}a[r].onload=o;a[r].src=f(a[r]);r=r+1}o()};var v=function n(i,d,s){var u=this;this.view=function(e){window.location.assign(s)};this.download=function(e,t,n){console.log("Store cert image view");var a=new jsPDF(t>n?"l":"p","px",[t,n]);a.addImage(e,"jpeg",0,0,t,n);a.save("certificate-"+(new Date).getTime()+".pdf")};this.reload=function(){window.location.reload()};this.dataURItoBlob=function(e,t){var n=atob(e.split(",")[1]);var a=new ArrayBuffer(n.length);var r=new Uint8Array(a);for(var o=0;o<n.length;o++){r[o]=n.charCodeAt(o)}return new Blob([a],{type:t})};this.store_certificate=function(t,n){var a=tutor_get_nonce_data(true);var r=new FormData;r.append("action","tutor_store_certificate_image");r.append("cert_hash",d);r.append("certificate_image",u.dataURItoBlob(t,"image/jpeg"),"certificate.jpg");r.append(a.key,a.value);e.ajax({url:window._tutorobject.ajaxurl,type:"POST",data:r,processData:false,contentType:false,success:function e(t){var a=(t.data||{}).message;n(t&&t.success,a)},error:function e(){n(false)}})};this.dispatch_conversion_methods=function(e,t,n){var a=t.getElementsByTagName("body")[0];var r=t.getElementById("watermark");var i=r.offsetWidth;var d=r.offsetHeight;a.style.display="inline-block";a.style.overflow="hidden";a.style.width=i+"px";a.style.height=d+"px";a.style.padding="0px";a.style.margin="0px";var s=t.getElementsByTagName("body")[0];var l={scale:3,letterRendering:true,logging:true,foreignObjectRendering:o,allowTaint:true,useCORS:true,x:0,y:0,width:i,height:d,windowWidth:i,windowHeight:d};p(t,(function(){html2canvas(s,l).then((function(t){var a=t.toDataURL("image/jpeg",1);u.store_certificate(a,(function(r,o){console.log("Store cert image");!r?alert(o||c("Something Went Wrong","tutor-pro")):0;r&&typeof u[e]=="function"?u[e](a,t.width,t.height):0;typeof n=="function"?n(r):0}))}))}))};this.load_certificate_builder=function(e){var t=document.createElement("iframe");t.width="1920";t.height="1080";t.style.position="absolute";t.style.left="-999999px";t.src=e;document.getElementsByTagName("body")[0].appendChild(t)};this.init_render_certificate=function(n,o){var s={action:"tutor_generate_course_certificate",course_id:i,certificate_hash:d||"",format:n=="download"?"pdf":"jpg"};e.ajax({url:window._tutorobject.ajaxurl,type:"POST",data:s,success:function d(s){if(!s.success){tutor_toast(c("Error","tutor-pro"),t(s),"error");return}var f=s.data.certificate_builder_url;if(f){window.tutor_certificate_after_build=function(){return o(true)};u.load_certificate_builder(f);return}var p=s.success?s.data.html:"";var v=document.createElement("iframe");var g=function t(n){n.write(p);n.write(e("<div></div>").append(e("#tutor_svg_font_id").clone()).html());if(a){var r=window.document.createElement("style");r.innerHTML="*{word-spacing:3px !important; letter-spacing:2px !important;}";n.getElementsByTagName("head")[0].appendChild(r)}};if(a||r){v.addEventListener("load",(function(){var e=v.contentWindow||v.contentDocument.document||v.contentDocument;e=e.document;g(e);l(i,(function(){return u.dispatch_conversion_methods(n,e,o)}))}))}else{l(i,(function(){var e=v.contentWindow||v.contentDocument.document||v.contentDocument;e=e.document;e.open();g(e);e.close();v.onload=function(){return u.dispatch_conversion_methods(n,e,o)}}))}v.style.position="absolute";v.style.left="-999999px";document.getElementsByTagName("body")[0].appendChild(v)}})}};var g=e(".tutor-certificate-pdf");var h=g.data("course_id");var m=g.data("cert_hash");var w=g.data("href");var _=new v(h,m,w);g.click((function(t){t.preventDefault();var n=e(this);n.closest("button").addClass("is-loading");_.init_render_certificate("download",(function(){n.closest("button").removeClass("is-loading")}))}));var y=e("#tutor-pro-certificate-download-image");y.click((function(t){t.preventDefault();var n=e("#tutor-pro-certificate-preview");var a=document.createElement("A");a.href=n.attr("src");a.download="certificate-"+(new Date).getTime()+".jpg";document.body.appendChild(a);a.click();document.body.removeChild(a)}));var b=new URL(window.location.href).searchParams.get("regenerate")==1;if(b||e("#tutor-pro-certificate-preview").data("is_generated")=="no"){_.init_render_certificate("",(function(){window.location.replace(e("#tutor-pro-certificate-preview").data("certificate_url"))}))}this.PrintDiv=function(){var e=document.querySelector("#div-to-print");var t=window.open("","_blank","width=800,height=500");t.document.open();t.document.write('<html><body onload="window.print()">'+e.innerHTML+"</html>");t.document.close()}}))})();